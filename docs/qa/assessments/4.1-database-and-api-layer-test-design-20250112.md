# Test Design: Story 4.1

Date: 2025-01-12
Designer: Quinn (Test Architect)

## Test Strategy Overview

- Total test scenarios: 24
- Unit tests: 12 (50%)
- Integration tests: 8 (33%)
- E2E tests: 4 (17%)
- Priority distribution: P0: 8, P1: 10, P2: 6

## Test Scenarios by Acceptance Criteria

### AC1: Firestore collections and indexes exist

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-001 | Unit        | P0       | Verify collection structure | Data model validation    |
| 4.1-INT-001  | Integration | P0       | Test collection creation   | End-to-end data flow     |
| 4.1-E2E-001  | E2E         | P1       | Verify indexes work        | Performance validation   |

### AC2: Security rules restrict access

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-002 | Unit        | P0       | Test security rule logic   | Security validation      |
| 4.1-INT-002  | Integration | P0       | Test authenticated access  | Auth integration         |
| 4.1-INT-003  | Integration | P0       | Test unauthorized access   | Security boundary        |
| 4.1-E2E-002  | E2E         | P0       | Test ownership validation  | Critical security path   |

### AC3: POST /api/cases creates case

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-003 | Unit        | P1       | Test case creation logic   | Business logic           |
| 4.1-INT-004  | Integration | P1       | Test API endpoint          | API contract validation  |
| 4.1-INT-005  | Integration | P1       | Test validation errors     | Error handling           |

### AC4: GET /api/cases returns user cases

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-004 | Unit        | P1       | Test case listing logic    | Business logic           |
| 4.1-INT-006  | Integration | P1       | Test API endpoint          | API contract validation  |
| 4.1-INT-007  | Integration | P2       | Test empty results         | Edge case handling       |

### AC5: GET /api/cases/:id/steps returns ordered steps

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-005 | Unit        | P1       | Test step listing logic    | Business logic           |
| 4.1-INT-008  | Integration | P1       | Test API endpoint          | API contract validation  |
| 4.1-INT-009  | Integration | P2       | Test ordering validation   | Data integrity           |

### AC6: PATCH /api/steps/:id/complete toggles completion

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-006 | Unit        | P1       | Test completion logic      | Business logic           |
| 4.1-INT-010  | Integration | P1       | Test API endpoint          | API contract validation  |
| 4.1-INT-011  | Integration | P2       | Test validation errors     | Error handling           |

### AC7: POST /api/reminders stores reminder

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-007 | Unit        | P1       | Test reminder creation     | Business logic           |
| 4.1-INT-012  | Integration | P1       | Test API endpoint          | API contract validation  |
| 4.1-INT-013  | Integration | P2       | Test validation errors     | Error handling           |

### AC8: API endpoints return expected status codes

#### Scenarios

| ID           | Level       | Priority | Test                      | Justification            |
| ------------ | ----------- | -------- | ------------------------- | ------------------------ |
| 4.1-UNIT-008 | Unit        | P1       | Test status code logic     | API contract validation  |
| 4.1-INT-014  | Integration | P1       | Test all endpoints         | Comprehensive coverage   |
| 4.1-E2E-003  | E2E         | P1       | Test Postman collection    | Manual testing support   |
| 4.1-E2E-004  | E2E         | P2       | Test error scenarios       | Error handling           |

## Risk Coverage

### Critical Security Risks

- **SEC-001 (No Authentication)**: Covered by 4.1-INT-002, 4.1-INT-003, 4.1-E2E-002
- **SEC-002 (Missing Ownership)**: Covered by 4.1-INT-003, 4.1-E2E-002
- **DATA-001 (Security Rules)**: Covered by 4.1-UNIT-002, 4.1-INT-002, 4.1-INT-003

### High Priority Business Logic

- **Case Creation**: Covered by 4.1-UNIT-003, 4.1-INT-004, 4.1-INT-005
- **Step Management**: Covered by 4.1-UNIT-005, 4.1-UNIT-006, 4.1-INT-008, 4.1-INT-010
- **Reminder System**: Covered by 4.1-UNIT-007, 4.1-INT-012, 4.1-INT-013

## Recommended Execution Order

1. P0 Unit tests (fail fast)
   - 4.1-UNIT-001, 4.1-UNIT-002, 4.1-UNIT-003, 4.1-UNIT-004
2. P0 Integration tests
   - 4.1-INT-001, 4.1-INT-002, 4.1-INT-003, 4.1-INT-004
3. P0 E2E tests
   - 4.1-E2E-001, 4.1-E2E-002
4. P1 tests in order
   - 4.1-UNIT-005, 4.1-UNIT-006, 4.1-UNIT-007, 4.1-UNIT-008
   - 4.1-INT-005, 4.1-INT-006, 4.1-INT-007, 4.1-INT-008, 4.1-INT-010, 4.1-INT-012, 4.1-INT-014
   - 4.1-E2E-003
5. P2 tests as time permits
   - 4.1-INT-009, 4.1-INT-011, 4.1-INT-013, 4.1-E2E-004

## Test Data Requirements

### Repository Tests
- Mock Firestore documents for all collections
- Test data for users, cases, steps, reminders
- Edge cases: empty collections, malformed data

### API Tests
- Valid request payloads for all endpoints
- Invalid request payloads for validation testing
- Authentication tokens (when implemented)
- Error response validation

### E2E Tests
- Complete user workflows
- Cross-user access attempts
- Performance baseline data
- Postman collection test data

## Test Environment Requirements

### Unit Tests
- Vitest with Firebase mocks
- Isolated repository testing
- No external dependencies

### Integration Tests
- Firebase emulator or test database
- Mock authentication context
- API endpoint testing

### E2E Tests
- Full application stack
- Real Firebase project (test environment)
- Postman or similar API testing tool
