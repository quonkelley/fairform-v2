# Story 6.5.4: Two-Column Layout & Progress Overview

## Status: Draft

## Story

As a **FairForm user**,
I want **a comprehensive case dashboard with progress overview and two-column layout**,
So that **I can see my case progress at a glance and access both my journey timeline and next steps in an organized way**.

## Context Source

- Source Document: Case Detail Realignment Plan
- Enhancement Type: UI layout enhancement and progress visualization
- Existing System Impact: Transforms single-column timeline into comprehensive two-column dashboard

## Acceptance Criteria

### Functional Requirements

1. **Progress Overview**: Display progress percentage, current step, and total steps at top of page
2. **Two-Column Layout**: Left column shows case journey timeline, right column shows next steps
3. **Responsive Design**: Layout stacks vertically on mobile with logical navigation order
4. **Integration**: Preserve existing StepDetailModal functionality and case journey features

### Technical Requirements

5. **Layout Component**: Update `/app/cases/[id]/page.tsx` with new layout structure
6. **Progress Component**: Create `ProgressOverview` component for top section
7. **Grid System**: Implement responsive CSS Grid for two-column layout

### Quality Requirements

8. **Accessibility**: Zero WCAG 2.1 AA violations, proper keyboard navigation
9. **Performance**: Page load time ≤ 1.5s mobile, layout shift ≤ 0.1
10. **Testing**: Component tests for layout and progress display

## Tasks / Subtasks

- [ ] **Task 1**: Create ProgressOverview component
  - [ ] Create `components/case-detail/ProgressOverview.tsx`
  - [ ] Display progress percentage and step counts
  - [ ] Add current step indicator
  - [ ] Implement responsive design

- [ ] **Task 2**: Update case detail page layout
  - [ ] Modify `/app/cases/[id]/page.tsx` for two-column structure
  - [ ] Implement responsive CSS Grid layout
  - [ ] Add proper spacing and alignment
  - [ ] Maintain existing breadcrumb and header

- [ ] **Task 3**: Integrate NextStepsCard component
  - [ ] Add NextStepsCard to right column
  - [ ] Connect to case progress state
  - [ ] Implement loading and error states
  - [ ] Add proper accessibility attributes

- [ ] **Task 4**: Implement responsive design
  - [ ] Stack columns on mobile devices
  - [ ] Ensure logical keyboard navigation order
  - [ ] Test on various screen sizes
  - [ ] Optimize for touch interactions

- [ ] **Task 5**: Add comprehensive testing
  - [ ] Component tests for ProgressOverview
  - [ ] Layout tests for responsive behavior
  - [ ] Accessibility tests for navigation
  - [ ] Performance tests for layout rendering

## Dev Notes

### Previous Story Context

This story builds on Stories 6.5.1, 6.5.2, and 6.5.3:
- Case type enum and status adapter foundation
- Template system with journey generation
- Next steps generator and panel component

### Technical Implementation

**ProgressOverview Component:**
```typescript
// components/case-detail/ProgressOverview.tsx
interface ProgressOverviewProps {
  caseId: string;
  progressPercentage: number;
  currentStep: number;
  totalSteps: number;
  caseType: CaseType;
}

export function ProgressOverview({ 
  caseId, 
  progressPercentage, 
  currentStep, 
  totalSteps, 
  caseType 
}: ProgressOverviewProps) {
  return (
    <Card className="w-full">
      <CardHeader>
        <CardTitle>Case Progress</CardTitle>
        <CardDescription>
          {caseType.replace('_', ' ')} case progress
        </CardDescription>
      </CardHeader>
      <CardContent>
        <div className="space-y-4">
          <div className="flex items-center justify-between">
            <span className="text-sm font-medium">Progress</span>
            <span className="text-sm text-muted-foreground">
              {progressPercentage}%
            </span>
          </div>
          <Progress value={progressPercentage} className="w-full" />
          <div className="flex items-center justify-between text-sm">
            <span>Step {currentStep} of {totalSteps}</span>
            <span className="text-muted-foreground">
              {totalSteps - currentStep + 1} steps remaining
            </span>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}
```

**Two-Column Layout Structure:**
```typescript
// app/cases/[id]/page.tsx
export default function CaseDetailPage({ params }: CaseDetailPageProps) {
  const caseId = params.id;
  const { data: caseData } = useCaseDetails(caseId);
  
  return (
    <ProtectedRoute>
      <div className="mx-auto flex min-h-screen w-full max-w-6xl flex-col gap-8 px-6 py-8">
        {/* Breadcrumb Navigation */}
        <nav aria-label="Breadcrumb" className="flex items-center gap-2 text-sm">
          <Link href="/dashboard" className="text-muted-foreground transition-colors hover:text-foreground">
            Dashboard
          </Link>
          <ChevronRight className="h-4 w-4 text-muted-foreground" />
          <span className="font-medium text-foreground">Case Details</span>
        </nav>

        {/* Page Header */}
        <header className="space-y-2">
          <h1 className="text-3xl font-bold text-foreground">Case Details</h1>
          <p className="text-base text-muted-foreground">
            Track your progress through each step of your case.
          </p>
        </header>

        {/* Progress Overview */}
        {caseData && (
          <ProgressOverview
            caseId={caseId}
            progressPercentage={caseData.progressPercentage}
            currentStep={caseData.currentStep}
            totalSteps={caseData.totalSteps}
            caseType={caseData.caseType}
          />
        )}

        {/* Two-Column Layout */}
        <div className="grid grid-cols-1 gap-8 lg:grid-cols-3">
          {/* Left Column: Case Journey */}
          <div className="lg:col-span-2">
            <CaseJourneyMap caseId={caseId} />
          </div>
          
          {/* Right Column: Next Steps */}
          <div className="lg:col-span-1">
            {caseData && (
              <NextStepsCard
                caseId={caseId}
                caseType={caseData.caseType}
                currentStep={caseData.currentStep}
              />
            )}
          </div>
        </div>
      </div>
    </ProtectedRoute>
  );
}
```

**Responsive CSS Grid:**
```css
/* Mobile-first responsive grid */
.grid-cols-1 {
  grid-template-columns: 1fr;
}

/* Large screens: 2/3 left, 1/3 right */
.lg:grid-cols-3 .lg:col-span-2 {
  grid-column: span 2;
}

.lg:grid-cols-3 .lg:col-span-1 {
  grid-column: span 1;
}
```

### File Locations

**New Files:**
- `components/case-detail/ProgressOverview.tsx` - Progress overview component
- `tests/components/case-detail/ProgressOverview.test.tsx` - Progress component tests

**Modified Files:**
- `app/cases/[id]/page.tsx` - Two-column layout implementation
- `tests/app/cases/[id]/page.test.tsx` - Page layout tests

### Design System Integration

- Uses shadcn/ui Card, Progress, and layout components
- Follows established spacing patterns (gap-8, px-6, py-8)
- Maintains consistent typography and color scheme
- Integrates with existing responsive breakpoints

### Repository Pattern

- Uses existing `useCaseDetails` hook for case data
- Integrates with `useCaseSteps` and `useNextSteps` hooks
- Maintains separation of concerns

### React Query Hook Pattern

**New Hook:**
```typescript
// lib/hooks/useCaseDetails.ts
export function useCaseDetails(caseId: string) {
  return useQuery({
    queryKey: ['case', caseId],
    queryFn: () => casesRepo.getCaseById(caseId),
    enabled: !!caseId,
  });
}
```

### Accessibility Requirements

- Progress overview has proper ARIA labels
- Two-column layout maintains logical keyboard navigation
- Screen readers announce progress changes
- Focus management works correctly in both columns
- Color contrast meets WCAG 2.1 AA standards

### Testing Requirements

**Unit Tests:**
- ProgressOverview component rendering
- Progress calculation display
- Responsive layout behavior

**Component Tests:**
- Two-column layout on different screen sizes
- Keyboard navigation between columns
- Progress updates and state changes

**Integration Tests:**
- Hook integration with layout components
- State synchronization between columns
- Performance with large case data

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
- ProgressOverview component implementation
- Two-column layout development
- Responsive design testing

### Completion Notes List
- ProgressOverview component created with progress visualization
- Two-column layout implemented with responsive design
- Case detail page updated with comprehensive dashboard
- Accessibility and keyboard navigation verified

### File List
**New Files:**
- `components/case-detail/ProgressOverview.tsx` - Progress overview component
- `tests/components/case-detail/ProgressOverview.test.tsx` - Progress component tests

**Modified Files:**
- `app/cases/[id]/page.tsx` - Two-column layout implementation
- `tests/app/cases/[id]/page.test.tsx` - Page layout tests

### Change Log
**2025-10-10**: Initial story creation for Epic 6.5 two-column layout
- Created ProgressOverview component with progress visualization
- Implemented two-column layout with responsive design
- Updated case detail page with comprehensive dashboard

## Testing

### Test Strategy
- Component tests for ProgressOverview and layout
- Responsive design testing on multiple screen sizes
- Accessibility tests for navigation and screen readers
- Performance tests for layout rendering

### Test Coverage Targets
- ProgressOverview component: 100% line coverage
- Layout components: 100% line coverage
- Responsive behavior: 100% breakpoint coverage

### Accessibility Testing
- ARIA labels and descriptions validation
- Keyboard navigation testing
- Screen reader announcement testing
- Color contrast verification

### Performance Testing
- Page load time benchmarks (≤ 1.5s mobile)
- Layout shift measurement (≤ 0.1)
- Component rendering performance

## QA Results

*To be completed after implementation*

---

**Story Owner:** SM (Bob)  
**Created:** October 10, 2025  
**Epic:** 6.5 Case Detail V2 Enhancement  
**Dependencies:** Stories 6.5.1, 6.5.2, and 6.5.3 complete
