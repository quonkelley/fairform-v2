# Story 15.3: Auto-Intake Conversation Bridge

## Status
Draft

## Story
**As a** FairForm demo presenter,  
**I want** the Copilot conversation and dashboard context to immediately reflect imported notice data,  
**so that** the demo narrative flows from upload into guided next steps without manual tweaks.

## Acceptance Criteria

1. When a notice import or manual fallback completes, Copilot posts a summary message referencing case type, court (including township), notice date, and hearing date pulled from the imported payload, formatted as: "I see you have an eviction hearing at Center Township Small Claims Court on [date] for case [number]."
2. Glossary hints and the timeline refresh using imported case data, including regenerated steps and reminders seeded from the parsed payload.
3. Copilot follow-up prompts identify the next recommended action (e.g., prepare appearance form) based on imported case status and timeline updates.
4. Conversation state persists links to the imported case ID, enabling Copilot to answer questions about that specific case for the remainder of the session.
5. Demo walkthrough log captures `"copilot-import-ack"` entries with metadata describing the imported record and elapsed processing time.
6. Integration tests cover upload-to-copilot handoff (or manual fallback) ensuring messages, glossary hints, and timeline data reflect the imported notice.

## Tasks / Subtasks

- [ ] Task 1: Expose import completion signal to Copilot (AC: 1, 4)
  - [ ] Emit structured event from Case Import pipeline containing parsed notice payload and new case ID
  - [ ] Extend Copilot session state to store imported case metadata
  - [ ] Ensure state survives subsequent Copilot interactions in demo mode
- [ ] Task 2: Author Copilot summary response (AC: 1, 3)
  - [ ] Update response templates to narrate court, notice, and hearing details
  - [ ] Include next-step prompt tailored to imported timeline status
  - [ ] Provide fallback copy when data fields are missing
- [ ] Task 3: Refresh timeline and glossary context (AC: 2)
  - [ ] Regenerate demo steps and reminders after case import
  - [ ] Rebind glossary hint providers to imported glossary keys
  - [ ] Verify UI components re-render without requiring manual refresh
- [ ] Task 4: Persist conversation case linkage (AC: 4)
  - [ ] Attach imported case ID to Copilot session metadata and message history
  - [ ] Update downstream Copilot handlers to reference the linked case when answering questions
- [ ] Task 5: Instrument Copilot acknowledgement logging (AC: 5)
  - [ ] Add `console.info` (or demo logger) recording `"copilot-import-ack"` events with timing
  - [ ] Surface logs in Dev Notes for rehearsal scripts
- [ ] Task 6: Add integration and regression coverage (AC: 6)
  - [ ] Extend Playwright demo script to assert Copilot summary content and refreshed timeline
  - [ ] Add Vitest integration test ensuring event bridge updates Copilot state
  - [ ] Document validation steps (typecheck, lint, tests) for story handoff

## Dev Notes

### Previous Story Insights
- Story 15.2 publishes import completion by seeding demo repositories and navigating to the dashboard; reuse its success event to drive Copilot updates without duplicating parsing logic.

### Data Models
- Demo repository storage uses `Map` collections for cases and steps; after import, ensure updated entries mirror the structures shown in the eviction scenario for consistency. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:247]

### API Specifications
- Copilot intent handling relies on discriminated union responses; keep new event hooks consistent with existing Copilot architecture. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:343]

### Component Specifications
- Demo principles require resilient UI statesâ€”timeline and glossary updates should degrade gracefully if payload data is missing. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:7]

### File Locations
- Copilot conversation logic resides under `lib/copilot/**`; place new handlers or helpers alongside those modules. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:339]
- Demo scenario data lives in `lib/demo/scenarios/**`; timeline regeneration helpers should be co-located with existing scenario utilities. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:31]

### Technical Constraints
- Maintain strict TypeScript typing for Copilot session state and event payloads. [Source: docs/architecture/tech-stack.md:6]
- Follow repository abstraction patterns, updating demo repositories instead of mutating UI state directly. [Source: docs/architecture/coding-standards.md:7]
- Ensure asynchronous flows return typed promises and handle simulated delays defined in demo config. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:225]

### Project Structure Notes
- Copilot updates should reuse existing demo logging utilities; no structural conflicts identified when extending `lib/copilot` modules.

#### Testing
- Use Vitest for Copilot integration logic and Playwright for end-to-end verification of the demo handoff. [Source: docs/architecture/tech-stack.md:10]
- Follow coverage expectations for critical flows, particularly ensuring error cases are asserted. [Source: docs/architecture/coding-standards.md:38]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story draft for Copilot import bridge | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent during implementation_

### Debug Log References
_To be populated by dev agent during implementation_

### Completion Notes List
_To be populated by dev agent during implementation_

### File List
_To be populated by dev agent during implementation_

## QA Results
_To be populated by QA agent after implementation review_
