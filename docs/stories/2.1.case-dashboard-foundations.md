# Story 2.1: Case Dashboard Foundations

## Status
Draft

## Story
**As a** self-represented litigant,  
**I want** to view my existing cases and start a new case from the dashboard,  
**so that** I can stay organized and begin managing my legal journey immediately after sign-in.

## Acceptance Criteria

1. Authenticated users see a dashboard listing all of their cases ordered by created date, including title, case type, status, and created date.  
2. Selecting “Start New Case” opens a modal (or drawer) form with required fields; submitting valid data persists the case to Firestore and closes the modal.  
3. Newly created cases render in the dashboard list without a hard refresh (client state updates after mutation).  
4. Case cards navigate to the placeholder route `/case/[id]` when clicked.  
5. When no cases exist, an empty state with supportive copy and a CTA to create the first case is displayed.  
6. Dashboard layout is responsive (mobile-first) and meets WCAG 2.1 AA for focus order, labels, and contrast.  
7. Error states (failed load or failed create) show accessible messaging and log details via repository error handling.

## Tasks / Subtasks

- [ ] Fetch and display cases for the authenticated user (AC: 1,3,7)  
  - [ ] Implement `casesRepo.listByUser` in `lib/db/casesRepo.ts` using Firestore query with ownership checks (AC: 1,7)  
  - [ ] Create React Query hook `useUserCases` with loading/error states wired to UI (AC: 1,3,7)
- [ ] Build dashboard layout and case list UI (AC: 1,4,6)  
  - [ ] Implement responsive `DashboardLayout` with header, summary text, and grid/list styles per design spec (AC: 6)  
  - [ ] Create `CaseCard` component using shadcn/ui primitives with keyboard focus and click navigation to `/case/[id]` (AC: 1,4,6)
- [ ] Implement “Start New Case” flow (AC: 2,3,5,6,7)  
  - [ ] Build modal form with controlled inputs (case type select, jurisdiction, optional notes) using `react-hook-form` + Zod (AC: 2,6)  
  - [ ] Add repository mutation `casesRepo.create` and hook `useCreateCase` with optimistic or post-mutation refetch logic (AC: 2,3,7)  
  - [ ] Show empty state panel when `useUserCases` returns zero results, including CTA to open the modal (AC: 5)
- [ ] Error and loading handling (AC: 3,7)  
  - [ ] Surface loading skeletons/spinners aligned with design system tokens (AC: 6)  
  - [ ] Display accessible error toast/banner on load or create failure and log via shared error util (AC: 7)
- [ ] Write tests and validation (AC: 1–7)  
  - [ ] Component tests covering case list rendering, empty state, and modal submit success/failure (AC: 1–7)  
  - [ ] Integration test verifying navigation to `/case/[id]` and redirect for unauthenticated access (AC: 4,7)

## Dev Notes

- Dashboard route lives at `app/dashboard/page.tsx`; follow structure in `docs/architecture/source-tree.md` and keep fetching logic inside hooks/services. [Source: docs/architecture/source-tree.md]  
- Repositories must enforce ownership and map Firestore documents into typed DTOs; reference `cases` collection fields defined in the data model. [Source: docs/architecture/data-model.md]  
- Use shadcn/ui components and Tailwind tokens defined in the design spec to match card layouts, spacing, and empty state patterns. [Source: docs/design-spec.md]  
- Ensure React Query cache keys include the authenticated user ID; leverage Firebase Auth context established in Story 1.1 for session management. [Source: docs/prd/epic-2-case-dashboard.md]  
- Mutations should use optimistic updates or refetch-on-success depending on complexity; handle failure paths with accessible toasts per design guidelines. [Source: docs/architecture/tech-stack.md]  
- Navigation uses Next.js `useRouter` or `<Link>` to route to `/case/[id]`; placeholder page will be completed in later stories. [Source: docs/prd/epic-2-case-dashboard.md]

### Testing

- Follow Vitest + React Testing Library standards in `docs/architecture/coding-standards.md`.  
- Mock Firestore repositories via dependency injection or test doubles to avoid network calls.  
- Verify accessibility: keyboard traversal of cards, modal focus trapping, ARIA labels on buttons, and color contrast assertions when feasible.  
- Include tests for empty state messaging, load errors, and create errors to confirm AC coverage.

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-09 | 0.1 | Initial draft created from Sprint 1 backlog and PRD | Scrum Team |

## Dev Agent Record

### Agent Model Used

_To be completed by Dev Agent_

### Debug Log References

_To be completed by Dev Agent_

### Completion Notes List

_To be completed by Dev Agent_

### File List

_To be completed by Dev Agent_

## QA Results

_To be completed by QA Agent_
