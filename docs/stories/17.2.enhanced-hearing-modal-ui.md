# Story 17.2: Enhanced Hearing Step Modal UI

## Status
ðŸ“‹ Ready for Development

## Story
**As a** user preparing for a court hearing,
**I want** an immersive, well-organized modal experience when I click on my hearing step,
**so that** I can easily review what I need to prepare and feel confident going into court.

## Acceptance Criteria

1. HearingStepModal component created under components/case-journey/hearing/
2. Modal opens smoothly when clicking a hearing step (no jank, <200ms)
3. Modal contains all required sections: Overview, Checklist, Timeline, Court Details, Documents, Tips
4. Responsive design works on mobile, tablet, and desktop
5. Fully keyboard accessible (Tab navigation, ESC to close, focus trap)
6. jest-axe accessibility tests pass with 0 violations
7. Reduced motion preference respected (prefers-reduced-motion)
8. Special header shows hearing date with countdown
9. Visual design uses appropriate styling (professional, calming colors)
10. Design approved by UX team

## Tasks / Subtasks

- [ ] Task 1: Create base HearingStepModal component (AC: 1, 2, 5, 7)
  - [ ] Create components/case-journey/hearing/HearingStepModal.tsx
  - [ ] Import Dialog from @/components/ui/dialog
  - [ ] Set up component props interface:
    - `step: CaseStep` (with hearing type)
    - `isOpen: boolean`
    - `onClose: () => void`
    - `onAskAI?: (message?: string) => void`
  - [ ] Implement dialog with focus trap
  - [ ] Add ESC key handler
  - [ ] Set up reduced-motion CSS
  - [ ] Use max-w-4xl (larger than standard modal)

- [ ] Task 2: Create hearing date header with countdown (AC: 8)
  - [ ] Add DialogHeader with special styling
  - [ ] Show hearing date prominently
  - [ ] Calculate days until hearing
  - [ ] Show countdown badge ("In 3 days", "Tomorrow", "Today")
  - [ ] Color-code urgency (green: >7 days, yellow: 3-7 days, red: <3 days)

- [ ] Task 3: Create Overview section (AC: 3)
  - [ ] Display step name and description
  - [ ] Show step order and total steps
  - [ ] Add educational content from stepTypeContent
  - [ ] Use blue info box styling (match existing pattern)

- [ ] Task 4: Create HearingChecklist component (AC: 3)
  - [ ] Create components/case-journey/hearing/HearingChecklist.tsx
  - [ ] Props: `items: HearingChecklistItem[]`, `onChange: (items) => void`
  - [ ] Group items by category (Documents, Preparation, Logistics)
  - [ ] Render checkbox for each item
  - [ ] Show completion progress bar
  - [ ] Add category icons (FileText, BookOpen, MapPin)
  - [ ] Handle keyboard interaction (Space to toggle)
  - [ ] Apply optimistic UI updates

- [ ] Task 5: Create Timeline section (AC: 3)
  - [ ] Add "Day of Hearing Timeline" section
  - [ ] Show suggested timeline:
    - "1 day before: Review all documents"
    - "Morning of: Arrive 30 minutes early"
    - "During hearing: Stay calm and respectful"
    - "After hearing: Note any follow-up requirements"
  - [ ] Use timeline visual component (vertical line with dots)

- [ ] Task 6: Create Court Details section (AC: 3)
  - [ ] Add "Court Information" section
  - [ ] Display court name, address (from case data)
  - [ ] Show courtroom number if available
  - [ ] Add "Get Directions" link (Google Maps)
  - [ ] Show parking/transit information

- [ ] Task 7: Create Documents section (AC: 3)
  - [ ] Add "Documents to Bring" section
  - [ ] List completed forms with download links
  - [ ] Show checklist items from "documents" category
  - [ ] Add "Print All" button
  - [ ] Show file icons and sizes

- [ ] Task 8: Create Tips section (AC: 3, 9)
  - [ ] Add "Confidence Tips" section
  - [ ] Show case-type-specific tips
  - [ ] Use encouraging, supportive tone
  - [ ] Add icons for visual interest
  - [ ] Include "What to Expect" subsection

- [ ] Task 9: Add Ask AI integration (AC: 3)
  - [ ] Add "Need Help?" footer button
  - [ ] Wire up onAskAI callback
  - [ ] Pre-fill with hearing-specific question
  - [ ] Close modal when AI opens

- [ ] Task 10: Implement responsive design (AC: 4)
  - [ ] Mobile: Single column, stacked sections
  - [ ] Tablet: Two columns for some sections
  - [ ] Desktop: Optimal layout with sidebar
  - [ ] Test on multiple screen sizes
  - [ ] Ensure modal height doesn't exceed viewport

- [ ] Task 11: Add keyboard navigation (AC: 5)
  - [ ] Tab order flows logically through sections
  - [ ] Focus visible on all interactive elements
  - [ ] ESC closes modal
  - [ ] Focus returns to step card on close
  - [ ] Focus trap prevents tabbing outside modal

- [ ] Task 12: Write component tests (AC: 6)
  - [ ] Create components/case-journey/hearing/HearingStepModal.test.tsx
  - [ ] Test modal opens/closes
  - [ ] Test all sections render
  - [ ] Test keyboard navigation
  - [ ] Test checklist interaction
  - [ ] Run jest-axe accessibility tests
  - [ ] Verify 0 violations

- [ ] Task 13: Write HearingChecklist tests
  - [ ] Create components/case-journey/hearing/HearingChecklist.test.tsx
  - [ ] Test item grouping by category
  - [ ] Test checkbox interaction
  - [ ] Test progress calculation
  - [ ] Test keyboard interaction (Space key)
  - [ ] Run jest-axe tests

- [ ] Task 14: UX review and refinement (AC: 10)
  - [ ] Record demo video of modal flow
  - [ ] Request UX review
  - [ ] Gather feedback on layout and content
  - [ ] Make requested adjustments
  - [ ] Get final approval

## Technical Notes

### Component Structure

```typescript
// components/case-journey/hearing/HearingStepModal.tsx

export interface HearingStepModalProps {
  step: CaseStep; // Must have stepType: "hearing"
  isOpen: boolean;
  onClose: () => void;
  onAskAI?: (message?: string) => void;
}

export function HearingStepModal({ step, isOpen, onClose, onAskAI }: HearingStepModalProps) {
  const daysUntilHearing = calculateDaysUntil(step.dueDate);

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="max-w-4xl max-h-[90vh] overflow-y-auto">
        {/* Header with countdown */}
        <HearingHeader step={step} daysUntil={daysUntilHearing} />

        <div className="space-y-8 py-6">
          {/* Overview */}
          <OverviewSection step={step} />

          {/* Checklist */}
          <HearingChecklist
            items={step.hearingChecklist || []}
            onChange={(items) => {/* handle update */}}
          />

          {/* Timeline */}
          <TimelineSection />

          {/* Court Details */}
          <CourtDetailsSection caseData={...} />

          {/* Documents */}
          <DocumentsSection caseId={step.caseId} />

          {/* Tips */}
          <TipsSection caseType={...} />
        </div>

        {/* Footer */}
        <DialogFooter>
          <Button onClick={() => onAskAI?.(`Help me prepare for my hearing`)}>
            Need Help? Ask AI
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

### HearingChecklist Component

```typescript
// components/case-journey/hearing/HearingChecklist.tsx

export interface HearingChecklistProps {
  items: HearingChecklistItem[];
  onChange: (items: HearingChecklistItem[]) => void;
}

export function HearingChecklist({ items, onChange }: HearingChecklistProps) {
  const groupedItems = groupBy(items, 'category');
  const completedCount = items.filter(i => i.completed).length;
  const progress = (completedCount / items.length) * 100;

  const toggleItem = (id: string) => {
    const updated = items.map(item =>
      item.id === id ? { ...item, completed: !item.completed } : item
    );
    onChange(updated);
  };

  return (
    <div className="space-y-6">
      <div>
        <h3 className="text-lg font-semibold mb-2">Preparation Checklist</h3>
        <Progress value={progress} className="h-2" />
        <p className="text-sm text-muted-foreground mt-1">
          {completedCount} of {items.length} items complete
        </p>
      </div>

      {Object.entries(groupedItems).map(([category, categoryItems]) => (
        <div key={category}>
          <h4 className="font-medium text-sm uppercase text-muted-foreground mb-3 flex items-center gap-2">
            {getCategoryIcon(category)}
            {category}
          </h4>
          <div className="space-y-2">
            {categoryItems.map(item => (
              <label
                key={item.id}
                className="flex items-start gap-3 p-3 rounded-lg hover:bg-muted/50 cursor-pointer"
              >
                <Checkbox
                  checked={item.completed}
                  onCheckedChange={() => toggleItem(item.id)}
                  className="mt-0.5"
                />
                <span className={cn(
                  "text-sm",
                  item.completed && "line-through text-muted-foreground"
                )}>
                  {item.label}
                </span>
                {item.reminderId && (
                  <Badge variant="secondary" className="ml-auto">
                    Reminder Set
                  </Badge>
                )}
              </label>
            ))}
          </div>
        </div>
      ))}
    </div>
  );
}
```

### Countdown Badge Styling

```typescript
function getCountdownBadge(daysUntil: number) {
  if (daysUntil === 0) {
    return <Badge variant="destructive">Today</Badge>;
  } else if (daysUntil === 1) {
    return <Badge variant="destructive">Tomorrow</Badge>;
  } else if (daysUntil <= 3) {
    return <Badge variant="destructive">In {daysUntil} days</Badge>;
  } else if (daysUntil <= 7) {
    return <Badge variant="warning">In {daysUntil} days</Badge>;
  } else {
    return <Badge variant="secondary">In {daysUntil} days</Badge>;
  }
}
```

## Design Guidelines

### Color Palette
- Primary: Use for checklist items, progress bar
- Muted: Use for section backgrounds
- Blue: Use for informational sections (overview, tips)
- Amber: Use for timeline items
- Red/Yellow/Green: Use for urgency badges

### Typography
- Headers: font-semibold text-lg or text-xl
- Body: text-sm text-muted-foreground
- Section titles: text-base font-medium

### Spacing
- Between sections: space-y-8
- Within sections: space-y-4
- List items: space-y-2

### Icons (from lucide-react)
- Documents: FileText
- Preparation: BookOpen
- Logistics: MapPin
- Timeline: Clock
- Court: Building
- Tips: Lightbulb

## Validation Checklist

- [ ] Component renders without errors
- [ ] TypeScript type-check passes
- [ ] ESLint passes with 0 errors
- [ ] All sections display correctly
- [ ] Modal animation smooth (<200ms)
- [ ] Keyboard navigation works
- [ ] jest-axe accessibility tests pass (0 violations)
- [ ] Works on mobile, tablet, desktop
- [ ] Reduced motion respected
- [ ] Focus trap works correctly
- [ ] UX approved

## Dependencies

- Story 17.1 (hearing step type & data) - MUST BE COMPLETE
- shadcn/ui Dialog component
- lucide-react icons
- Case step data with hearing type

## Estimated Effort
3 days

## Dev Agent Record

### Implementation Summary
_To be filled during development_

### Files Created
_To be filled during development_

### Quality Checks
_To be filled during development_

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-17 | 1.0 | Initial story creation | SM |
