# Story 15.1: Import Parser & Fixtures

## Status
Draft

## Story
**As a** FairForm demo presenter,  
**I want** the Marion County eviction notice asset parsed into typed case data,  
**so that** the demo can auto-create the eviction case immediately after an upload.

## Acceptance Criteria

1. A Marion County eviction notice JSON fixture exists containing the structured case fields (`caseType`, `court`, `hearingDate`, `noticeDate`, parties, address) plus glossary metadata required by the demo.
2. `parseDemoNotice(fileName)` reads the matching fixture, validates the schema, and returns a typed success result; unknown filenames or malformed data return a typed error without throwing.
3. Vitest unit tests cover the happy path, an unsupported filename, and malformed JSON scenarios (syntax errors, missing required fields, invalid field types); fixtures expose timeline/glossary metadata used by downstream import consumers.

## Tasks / Subtasks

- [ ] Task 1: Define typed notice payload contracts (AC: 1, 2)
  - [ ] Describe notice result type covering case payload, timeline seeds, glossary keys
  - [ ] **Document field mapping between notice JSON and Case schema (caseNumber → case metadata, hearingDate → step due dates)**
  - [ ] Align result shape with `Case` and `CaseStep` fields used in demo scenarios
  - [ ] Export types from `lib/demo/types.ts` or inline in `importNotice.ts`
  - [ ] Export discriminated union for success vs error results
- [ ] Task 2: Create Marion County eviction fixture (AC: 1)
  - [ ] **Create `lib/demo/imports/eviction.notice.json` fixture file**
  - [ ] Author fixture with values mirroring current eviction scenario (case number, hearing date, parties, address)
  - [ ] **Include glossary term IDs matching eviction scenario (e.g., 'eviction-notice', 'answer', 'default-judgment')**
  - [ ] Add timeline and reminder metadata placeholders for downstream stories
- [ ] Task 3: Implement `parseDemoNotice` (AC: 2)
  - [ ] **Create parser utility at `lib/demo/importNotice.ts`**
  - [ ] Load fixture assets from `lib/demo/imports/` directory based on filename
  - [ ] Validate schema before returning data
  - [ ] **Add simulated delay using demoConfig.timing.scanDelay (1500ms)**
  - [ ] Map parsed data into typed result structure
  - [ ] Return typed error for unknown filename or invalid payload
- [ ] Task 4: Add Vitest coverage (AC: 3)
  - [ ] Test happy path fixture parsing returns structured data
  - [ ] Test unsupported filename returns typed error without throwing
  - [ ] **Test malformed JSON (syntax error), missing required fields, and invalid field types**
  - [ ] Snapshot result structure for regression safety
- [ ] Task 5: Document demo repository reset contract (AC: 1, 2, 3)
  - [ ] Record expected repository interaction for downstream stories in story Dev Notes
  - [ ] Identify follow-up tasks for scenario merge utility (link to Story 15.2)

## Dev Notes

### Previous Story Insights
- No completed Epic 15 stories exist yet; treat this story as the starting point for the case import flow.

### Data Models
- Demo repositories mirror the production `Case` and `CaseStep` schemas; ensure fixture fields align with those structures (`caseType`, `jurisdiction`, parties, due dates). [Source: docs/architecture/data-model.md:11]
- **Critical Field Mapping**: Notice JSON fields must map to Case schema - caseNumber maps to case metadata, hearingDate maps to step due dates, parties map to case participants. [Source: lib/demo/scenarios/eviction.ts:13-16]
- **Glossary Integration**: Eviction scenario uses glossaryTerms object with IDs like 'eviction-notice', 'answer', 'default-judgment'; steps have glossaryKeys arrays for downstream enrichment. [Source: lib/demo/scenarios/eviction.ts:25-35]

### API Specifications
- No specific API endpoints are invoked in this story; repository integration occurs in later stories. No specific guidance found in architecture docs.

### Component Specifications
- UI components are not part of this story’s scope. No specific guidance found in architecture docs.

### File Locations
- Demo scenarios and repositories live under `lib/demo/**`; place fixtures and parser utilities alongside existing demo data modules. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:31]
- Tests should reside under `tests/` mirroring source paths (e.g., `tests/lib/demo/importNotice.test.ts`). [Source: docs/architecture/source-tree.md:37]

### Technical Constraints
- Maintain TypeScript strict typing for parser utilities and result unions. [Source: docs/architecture/tech-stack.md:6]
- Follow repository separation—keep parsing logic in `lib/demo` utilities rather than UI components. [Source: docs/architecture/coding-standards.md:7]
- Implement resilient states by returning structured errors instead of throwing, supporting graceful demo degradation. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:7]
- **Simulated Processing Delay**: Use demoConfig.timing.scanDelay (1500ms) to mimic OCR processing time, aligning with demo architecture timing patterns. [Source: docs/architecture/DEMO-ARCHITECTURE-ROBUST.md:45]

### Project Structure Notes
- Ensure new files follow the established `lib/demo` module organization; no structural conflicts identified.

#### Testing
- Use Vitest with React Testing Library utilities where needed; place specs alongside mirror path under `tests/`. [Source: docs/architecture/tech-stack.md:10]
- Maintain coverage expectations for repository-adjacent utilities (≥80%) and include error-path assertions. [Source: docs/architecture/coding-standards.md:38]

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story draft for parser and fixtures work | Bob (Scrum Master) |
| 2025-10-16 | 1.1 | Applied PO review refinements: added field mapping details, glossary integration contract, test specificity, and processing delay context | Sarah (Product Owner) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent during implementation_

### Debug Log References
_To be populated by dev agent during implementation_

### Completion Notes List
_To be populated by dev agent during implementation_

### File List
_To be populated by dev agent during implementation_

## QA Results
_To be populated by QA agent after implementation review_
