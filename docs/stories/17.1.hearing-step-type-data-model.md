# Story 17.1: Hearing Step Type & Data Model

## Status
ðŸ“‹ Ready for Development

## Story
**As a** system architect,
**I want** to add a `hearing` step type and define the hearing prep data structure,
**so that** we can support enhanced hearing day experiences in the case journey.

## Acceptance Criteria

1. `hearing` added to StepTypeSchema enum in lib/validation.ts
2. Zod schema created for hearing checklist items with required fields
3. `hearingChecklist` field added to CaseStepSchema (optional array)
4. Journey templates for small claims and eviction include hearingPrep metadata
5. Hearing step content added to stepTypeContent.ts
6. TypeScript compiles without errors
7. All Zod validations work correctly
8. Test coverage for new schemas â‰¥80%
9. Content reviewed and approved by legal/UX stakeholders

## Tasks / Subtasks

- [ ] Task 1: Add hearing step type to validation schema (AC: 1, 6)
  - [ ] Add `"hearing"` to StepTypeSchema enum in lib/validation.ts
  - [ ] Verify TypeScript compilation
  - [ ] Run type-check: `npm run type-check`

- [ ] Task 2: Create hearing checklist schema (AC: 2, 3, 7)
  - [ ] Create HearingChecklistItemSchema with fields:
    - `id: string` - Unique identifier
    - `label: string` - Display text for checklist item
    - `completed: boolean` - Completion status
    - `category: enum` - "documents", "preparation", "logistics"
    - `reminderId: string | null` - Optional link to reminder
    - `order: number` - Display order
  - [ ] Add `hearingChecklist` optional array field to CaseStepSchema
  - [ ] Export HearingChecklistItem type
  - [ ] Test schema validation with sample data

- [ ] Task 3: Add hearing content to stepTypeContent.ts (AC: 5)
  - [ ] Add hearing entry to stepTypeContent record:
    - Title: "About Court Hearings"
    - Description: Overview of what happens at hearings
    - Tips: Array of 3-5 preparation tips
  - [ ] Import and verify getStepTypeContent returns hearing content

- [ ] Task 4: Update journey templates with hearingPrep data (AC: 4)
  - [ ] Edit lib/journeys/templates/smallClaims.ts
    - [ ] Add hearingPrep metadata to hearing step
    - [ ] Include checklist items for small claims hearings:
      - Documents: filed forms, evidence copies, receipts
      - Preparation: review case facts, prepare statement
      - Logistics: court location, arrival time, dress code
  - [ ] Edit lib/journeys/templates/eviction.ts
    - [ ] Add hearingPrep metadata to hearing step
    - [ ] Include checklist items for eviction hearings:
      - Documents: lease, payment records, photos
      - Preparation: review lease terms, tenant rights
      - Logistics: court location, witness list
  - [ ] Ensure all items have proper category and order

- [ ] Task 5: Write tests for new schemas (AC: 8)
  - [ ] Create tests/lib/validation/hearingChecklist.test.ts
  - [ ] Test valid hearing checklist item
  - [ ] Test invalid checklist item (missing fields)
  - [ ] Test hearingChecklist array validation
  - [ ] Test optional hearingChecklist (null/undefined)
  - [ ] Run tests: `npm test tests/lib/validation/hearingChecklist.test.ts`
  - [ ] Verify coverage â‰¥80%

- [ ] Task 6: Update journey template tests (AC: 8)
  - [ ] Update tests/lib/journeys/templates/smallClaims.test.ts
  - [ ] Update tests/lib/journeys/templates/eviction.test.ts
  - [ ] Verify hearing steps include hearingPrep metadata
  - [ ] Snapshot test template output

- [ ] Task 7: Content review and approval (AC: 9)
  - [ ] Document hearing checklist items in review doc
  - [ ] Request legal team review for accuracy
  - [ ] Request UX review for clarity and completeness
  - [ ] Incorporate feedback and update templates

## Technical Notes

### Zod Schema Structure

```typescript
// lib/validation.ts

export const HearingChecklistCategorySchema = z.enum([
  "documents",
  "preparation",
  "logistics"
]);

export const HearingChecklistItemSchema = z.object({
  id: z.string(),
  label: z.string().min(1),
  completed: z.boolean(),
  category: HearingChecklistCategorySchema,
  reminderId: z.string().nullable().optional(),
  order: z.number().int().min(0),
});

// Add to StepTypeSchema
export const StepTypeSchema = z.enum([
  "form",
  "document",
  "review",
  "submit",
  "wait",
  "meeting",
  "communication",
  "hearing", // NEW
]);

// Update CaseStepSchema
export const CaseStepSchema = z.object({
  // ... existing fields
  hearingChecklist: z.array(HearingChecklistItemSchema).optional(),
});

export type HearingChecklistItem = z.infer<typeof HearingChecklistItemSchema>;
export type HearingChecklistCategory = z.infer<typeof HearingChecklistCategorySchema>;
```

### Journey Template Example

```typescript
// lib/journeys/templates/smallClaims.ts

{
  name: "Attend Small Claims Hearing",
  stepType: "hearing",
  estimatedTime: 120,
  description: "Attend your scheduled hearing and present your case to the judge.",
  hearingPrep: [
    {
      id: "docs-1",
      label: "Bring copies of all filed forms and evidence",
      completed: false,
      category: "documents",
      order: 0
    },
    {
      id: "docs-2",
      label: "Bring itemized receipts or invoices",
      completed: false,
      category: "documents",
      order: 1
    },
    {
      id: "prep-1",
      label: "Review your case facts and timeline",
      completed: false,
      category: "preparation",
      order: 2
    },
    {
      id: "prep-2",
      label: "Prepare a brief opening statement (2-3 minutes)",
      completed: false,
      category: "preparation",
      order: 3
    },
    {
      id: "log-1",
      label: "Arrive 30 minutes early",
      completed: false,
      category: "logistics",
      order: 4
    },
    {
      id: "log-2",
      label: "Dress professionally (business casual or better)",
      completed: false,
      category: "logistics",
      order: 5
    }
  ]
}
```

### stepTypeContent Addition

```typescript
// lib/journeys/stepTypeContent.ts

hearing: {
  title: "About Court Hearings",
  description: "This step involves appearing before a judge to present your case and hear the opposing side's arguments.",
  tips: [
    "Arrive at least 30 minutes early to find parking and locate the courtroom",
    "Dress professionally and address the judge as 'Your Honor'",
    "Bring multiple copies of all documents - one for you, one for the judge, one for the other party",
    "Speak clearly, stay calm, and only speak when asked by the judge",
    "Be prepared to answer questions about your case and provide evidence"
  ]
}
```

## Validation Checklist

- [ ] TypeScript compilation succeeds (`npm run type-check`)
- [ ] ESLint passes with 0 errors (`npm run lint`)
- [ ] All tests pass (`npm test`)
- [ ] Test coverage â‰¥80% for new code
- [ ] Zod schemas validate correctly with sample data
- [ ] Journey templates include realistic hearing prep items
- [ ] Content reviewed by legal team
- [ ] Content reviewed by UX team

## Dependencies

- Epic 6.5 (case journey system) - COMPLETE
- lib/validation.ts
- lib/journeys/templates/
- lib/journeys/stepTypeContent.ts

## Estimated Effort
2 days

## Dev Agent Record

### Implementation Summary
_To be filled during development_

### Files Modified
_To be filled during development_

### Quality Checks
_To be filled during development_

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-17 | 1.0 | Initial story creation | SM |
