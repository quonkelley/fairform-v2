# Story 13.37: Save & Resume Case Creation

## Status
ðŸ“‹ Planned
Urgency: (low priority for demo)

## Story
**As a** user who can't complete case creation in one sitting,
**I want** to save my progress and return later,
**so that** I don't have to start over if I get interrupted.

## Acceptance Criteria

1. "Save for Later" button appears during information gathering
2. Saves conversation state and collected information to user account
3. Email reminder sent after 24 hours if case not completed
4. Deep link in email returns to exact conversation state
5. Shows progress percentage on resume
6. Resume banner appears when returning to saved conversation
7. Works across devices (save on mobile, resume on desktop)
8. Saved conversations expire after 30 days
9. List of saved conversations accessible from dashboard

## Tasks / Subtasks

- [ ] Task 1: Add "Save for Later" UI (AC: 1)
  - [ ] Button in chat panel
  - [ ] Confirmation toast
  - [ ] Save progress indicator

- [ ] Task 2: Persist conversation state (AC: 2, 7)
  - [ ] Save to Firestore with user ID
  - [ ] Include all messages and collectedInfo
  - [ ] Associate with session

- [ ] Task 3: Email reminders (AC: 3, 4)
  - [ ] Schedule email via Cloud Functions
  - [ ] Generate deep link with session ID
  - [ ] Email template with progress summary

- [ ] Task 4: Resume experience (AC: 5, 6)
  - [ ] Restore conversation from saved state
  - [ ] Show progress percentage
  - [ ] Welcome back message
  - [ ] "Continue where you left off" banner

- [ ] Task 5: Saved conversations list (AC: 9)
  - [ ] Dashboard widget showing saved conversations
  - [ ] Click to resume
  - [ ] Delete option

- [ ] Task 6: Expiration & cleanup (AC: 8)
  - [ ] Mark conversations as expired after 30 days
  - [ ] Cleanup job (Cloud Function)

- [ ] Task 7: Testing (AC: All)
  - [ ] Test save/resume flow
  - [ ] Test across devices
  - [ ] Test email delivery
  - [ ] Test expiration

## Dev Notes

### Save Conversation Schema

```typescript
interface SavedConversation {
  id: string;
  userId: string;
  sessionId: string;
  conversationStage: ConversationStage;
  collectedInfo: MinimumCaseInfo;
  messages: AIMessage[];
  progress: number; // 0-100
  savedAt: Timestamp;
  expiresAt: Timestamp; // savedAt + 30 days
  resumeCount: number;
}
```

### Deep Link

```typescript
// Generate link
const deepLink = `${process.env.NEXT_PUBLIC_APP_URL}/chat/resume?sid=${sessionId}`;

// Resume route
app.get('/chat/resume', async (req, res) => {
  const { sid } = req.query;
  const saved = await loadSavedConversation(sid);

  // Restore conversation state
  res.redirect(`/dashboard?openChat=true&sessionId=${sid}`);
});
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story creation | Product Team |

