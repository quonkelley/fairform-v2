# Story 18.5: Demo Mode Form Filler Integration

## Status
Planned

## Story
**As a** FairForm demo presenter,
**I want** the form filler to work seamlessly in demo mode with fast, deterministic behavior,
**so that** I can show investors a polished 3-5 minute form completion flow.

## Acceptance Criteria

1. Demo mode uses pre-filled form scenarios (no user typing required)
2. Demo PDF templates load from `/public/demo/forms/` (no Firebase calls)
3. PDF generation works offline with demo templates
4. Demo form session auto-advances through fields with timing delays
5. All form data pre-populated from demo case context
6. Demo mode indicator shows "DEMO MODE" in form session UI
7. Demo forms saved to in-memory storage (cleared on reset)
8. Complete demo flow runs in 2-3 minutes (fast-forward mode)

## Tasks / Subtasks

- [ ] Task 1: Create demo form scenarios (AC: 1, 5)
  - [ ] Create `lib/demo/formScenarios.ts`
  - [ ] Define pre-filled data for Marion Appearance form
  - [ ] Match fields to existing eviction demo case
  - [ ] Export `getDemoFormData(formId: string, caseId: string): Record<string, any>`

- [ ] Task 2: Update demo storage adapter for forms (AC: 2, 7)
  - [ ] Update `lib/demo/demoStorageAdapter.ts` from Story 18.1
  - [ ] Add in-memory form storage (Map)
  - [ ] Return `/demo/forms/` paths for templates
  - [ ] Simulate upload delay (200ms)
  - [ ] Clear storage on demo reset

- [ ] Task 3: Add demo mode to FormSession (AC: 4, 6)
  - [ ] Add `demo` prop to FormSession component
  - [ ] Show "DEMO MODE" badge in UI
  - [ ] Auto-populate fields immediately (no user input)
  - [ ] Auto-advance every 1.5 seconds with smooth animation
  - [ ] Add skip button for presenter control

- [ ] Task 4: Integrate with demo mode configuration (AC: 8)
  - [ ] Update `lib/demo/demoConfig.ts`
  - [ ] Add `formFillerEnabled: true`
  - [ ] Add `formAutoAdvanceDelay: 1500` (ms)
  - [ ] Add `formSkipIntroduction: false` (for repeat demos)

- [ ] Task 5: Update generate API for demo mode (AC: 3, 7)
  - [ ] Detect demo mode in `app/api/forms/generate/route.ts`
  - [ ] Skip Firebase Storage upload in demo
  - [ ] Use demoStorageAdapter instead
  - [ ] Return demo download URL (blob or public path)
  - [ ] Save to in-memory repo (no Firestore)

- [ ] Task 6: Create demo PDF templates (AC: 2, 3)
  - [ ] Find or create Marion County Appearance PDF with fillable fields
  - [ ] Place in `public/demo/forms/marion-appearance-template.pdf`
  - [ ] Test loads in browser without auth
  - [ ] Verify pdf-lib can fill fields

- [ ] Task 7: Add demo form flow to Copilot script (AC: 8)
  - [ ] Update `lib/demo/scenarios/eviction.ts`
  - [ ] Add form suggestion after user asks about appearing in court
  - [ ] Pre-script conversation: "I need to file an appearance"
  - [ ] Copilot response: "I'll help you fill out the Appearance form..."
  - [ ] Trigger FormSession automatically

- [ ] Task 8: Test complete demo flow (AC: 8)
  - [ ] Start eviction demo case
  - [ ] Ask Copilot about filing appearance
  - [ ] FormSession starts with demo data
  - [ ] Auto-advance through 3-5 fields (1.5s each)
  - [ ] PDF generates successfully
  - [ ] Download works
  - [ ] Time complete flow: should be 2-3 minutes
  - [ ] Verify demo reset clears forms

## Dev Notes

### Architecture Context
This story ensures the form filler works flawlessly in demo mode. Demos are critical for investor presentations - they must be fast, reliable, and impressive.

**Demo Requirements:**
- No typing (pre-filled data)
- Fast pacing (auto-advance every 1.5s)
- Offline capable (no API dependencies)
- Deterministic (same every time)
- Professional polish (smooth animations)

### Demo Form Scenarios
```typescript
// lib/demo/formScenarios.ts
export const demoFormData = {
  'marion-appearance': {
    'eviction-case-1': {
      defendant_name: 'Jane Doe',
      case_number: '49D01-2410-SC-012345',
      hearing_date: '2025-11-15',
      self_represented: true,
      address: '123 Main St, Indianapolis, IN 46204',
      phone: '(317) 555-0123'
    }
  }
};

export function getDemoFormData(formId: string, caseId: string): Record<string, any> {
  return demoFormData[formId]?.[caseId] || {};
}
```

### Demo FormSession with Auto-Advance
```typescript
// In FormSession.tsx
export function FormSession({ formId, caseId, demo = false, ...props }) {
  const [autoAdvanceEnabled, setAutoAdvanceEnabled] = useState(demo);
  const [currentFieldIndex, setCurrentFieldIndex] = useState(0);

  useEffect(() => {
    if (!demo || !autoAdvanceEnabled) return;

    // Auto-advance every 1.5 seconds
    const timer = setTimeout(() => {
      if (currentFieldIndex < template.fields.length - 1) {
        setCurrentFieldIndex(prev => prev + 1);
      } else {
        // Last field - complete form
        handleComplete();
      }
    }, 1500);

    return () => clearTimeout(timer);
  }, [currentFieldIndex, demo, autoAdvanceEnabled]);

  // Pre-fill all fields in demo mode
  useEffect(() => {
    if (demo) {
      const demoData = getDemoFormData(formId, caseId);
      setFieldValues(demoData);
    }
  }, [demo, formId, caseId]);

  return (
    <div className="form-session">
      {demo && (
        <div className="demo-badge">
          ðŸŽ¬ DEMO MODE
          <button onClick={() => setAutoAdvanceEnabled(!autoAdvanceEnabled)}>
            {autoAdvanceEnabled ? 'Pause' : 'Resume'}
          </button>
        </div>
      )}

      {/* Rest of form UI */}
    </div>
  );
}
```

### Demo Storage Adapter Updates
```typescript
// lib/demo/demoStorageAdapter.ts
const demoFormsStorage = new Map<string, Blob>();

export const demoStorageAdapter = {
  uploadFile: async (path: string, file: File | Blob): Promise<Result<string>> => {
    // Simulate upload delay
    await new Promise(resolve => setTimeout(resolve, 200));

    // Store in memory
    demoFormsStorage.set(path, file);

    // Return demo URL
    const demoUrl = `/demo/storage/${path}`;
    return { success: true, data: demoUrl };
  },

  getDownloadUrl: async (path: string): Promise<Result<string>> => {
    if (path.startsWith('forms/templates/')) {
      // Return public demo template path
      return { success: true, data: `/demo/forms/${path.split('/').pop()}` };
    }

    // Return blob URL for completed forms
    const blob = demoFormsStorage.get(path);
    if (!blob) {
      return { success: false, error: 'File not found' };
    }

    const blobUrl = URL.createObjectURL(blob);
    return { success: true, data: blobUrl };
  },

  clear: () => {
    demoFormsStorage.clear();
  }
};
```

### Generate API Demo Mode Detection
```typescript
// app/api/forms/generate/route.ts
export async function POST(request: NextRequest) {
  const isDemoMode = request.headers.get('x-demo-mode') === 'true';

  if (isDemoMode) {
    // Use demo adapter
    const pdfResult = await generatePDF(templateUrl, fields);
    const demoUpload = await demoStorageAdapter.uploadFile(storagePath, pdfResult.data);

    // Save to in-memory demo repo (not Firestore)
    demoFormsRepo.set(formRecordId, metadata);

    return NextResponse.json({
      success: true,
      downloadUrl: demoUpload.data,
      formRecordId,
      demo: true
    });
  }

  // Normal production flow...
}
```

### Demo Copilot Script
```typescript
// lib/demo/scenarios/eviction.ts
export const evictionScenario = {
  // ... existing scenario data

  conversationFlow: [
    // ... existing messages

    {
      trigger: 'user mentions "appearance" or "file" or "court"',
      response: `I can help you file an Appearance form with the court. This form tells the judge you're representing yourself and will appear at the hearing.

Would you like me to walk you through filling it out? It only takes a couple of minutes.`,
      formSuggestion: {
        formId: 'marion-appearance',
        autoStart: true // Start immediately in demo
      }
    }
  ],

  formData: {
    'marion-appearance': {
      defendant_name: 'Jane Doe',
      case_number: '49D01-2410-SC-012345',
      hearing_date: '2025-11-15',
      self_represented: true
    }
  }
};
```

### Demo Flow Timing
```
00:00 - User: "I need to file an appearance"
00:02 - Copilot: "I'll help you fill out the Appearance form..."
00:04 - FormSession starts (auto-filled)
00:05 - Field 1: "Your name?" â†’ Shows "Jane Doe" (auto)
00:07 - Field 2: "Case number?" â†’ Shows "49D01..." (auto)
00:09 - Field 3: "Hearing date?" â†’ Shows "Nov 15" (auto)
00:11 - Field 4: "Self-represented?" â†’ Checked (auto)
00:13 - Completion: "Generating your form..."
00:15 - Success: "Your Appearance Form is ready!"
00:16 - Confetti animation
00:18 - Download button shown
00:20 - Demo complete (total: ~2-3 minutes)
```

### Source Tree
```
lib/demo/
â”œâ”€â”€ demoStorageAdapter.ts       # MODIFY: Add form storage
â”œâ”€â”€ formScenarios.ts            # NEW: Pre-filled form data
â”œâ”€â”€ demoConfig.ts               # MODIFY: Add form settings
â””â”€â”€ scenarios/
    â””â”€â”€ eviction.ts             # MODIFY: Add form flow

public/demo/forms/
â””â”€â”€ marion-appearance-template.pdf  # NEW: Demo PDF template

components/ai-copilot/
â””â”€â”€ FormSession.tsx             # MODIFY: Add demo mode

app/api/forms/generate/
â””â”€â”€ route.ts                    # MODIFY: Handle demo mode
```

### Testing Strategy
- Test auto-advance timing (not too fast, not too slow)
- Test pause/resume in demo mode
- Test demo reset clears form storage
- Test PDF generation works with demo template
- Test complete flow takes 2-3 minutes
- Test works offline (no Firebase)

### Demo Presentation Tips
**Script for presenter:**
1. "Let me show you how FairForm helps users complete court forms..."
2. "Jane needs to file an Appearance form for her eviction case."
3. "Watch how the AI guides her through each field..."
4. [FormSession auto-advances through fields]
5. "In just a couple of minutes, her form is ready to download and file."
6. [Download PDF, show it opened]
7. "This is empowerment - turning legal advice into action."

**Presenter Controls:**
- Pause button to explain each field
- Skip button to fast-forward
- Reset button to start over

### Dependencies
- Stories 18.1-18.4 complete
- Existing demo mode infrastructure
- Marion County Appearance PDF template

### Implementation Notes
- Auto-advance timing: 1.5s is good balance (not rushed, not slow)
- Demo badge should be visible but not distracting
- Animations should be smooth (CSS transitions)
- Download should work even in demo mode (blob URL)
- Form data should match existing eviction scenario

### Out of Scope (Defer)
- Multiple demo scenarios â†’ Start with one (eviction appearance)
- Demo mode for other form types â†’ Just Appearance for MVP
- Presenter recording/playback â†’ Manual presentation only
- Analytics/tracking demo usage â†’ Post-MVP

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-16 | 1.0 | Initial story creation | PM |

## Dev Agent Record

### Agent Model Used
_To be filled by implementing agent_

### Debug Log References
_To be filled by implementing agent_

### Completion Notes List
_To be filled by implementing agent_

### File List
_To be filled by implementing agent_

## QA Results

### Test Results
_To be filled by QA_

### Acceptance Criteria Validation
_To be filled by QA_

### Next Steps
After completing Story 18.5, Epic 18 (Smart Form Filler) is complete! Proceed to:
1. Demo rehearsal with full flow
2. Documentation update
3. Stakeholder review
4. Plan next epic (if applicable)
