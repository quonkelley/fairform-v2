# Story 11.1: Settings Page Scaffold

## Status
Draft

## Story
**As a** registered FairForm user,
**I want** to access a settings page from the navigation,
**so that** I can view and manage my account preferences in one centralized location.

## Acceptance Criteria

1. Settings page exists at `/settings` route and is accessible via navigation menu.
2. Page is protected - only authenticated users can access (redirects to login if not authenticated).
3. Page displays user's email address (read-only) from Firebase Auth.
4. Page uses shadcn/ui Card components for visual organization.
5. Page is fully responsive (mobile-first design, works on 360px+ viewports).
6. Page meets WCAG 2.1 AA accessibility standards (zero jest-axe violations).
7. Page includes proper semantic HTML structure (headings, sections, labels).

## Tasks / Subtasks

- [ ] Task 1: Create Settings page route (AC: 1, 2)
  - [ ] Create `app/settings/page.tsx` as authenticated server component
  - [ ] Add route protection using `requireAuth` from `lib/auth/server-auth.ts`
  - [ ] Return 401/redirect if user not authenticated
  - [ ] Fetch current user data from Firebase Auth
  - [ ] Pass user data to client component for display

- [ ] Task 2: Add Settings link to navigation (AC: 1)
  - [ ] Update `components/layouts/AppHeader.tsx` to include Settings nav item
  - [ ] Add Settings icon (lucide-react Settings icon)
  - [ ] Link should navigate to `/settings`
  - [ ] Apply active state styling when on settings page
  - [ ] Ensure keyboard accessibility (Tab navigation)

- [ ] Task 3: Create Settings page UI structure (AC: 3, 4, 5)
  - [ ] Create `components/settings/SettingsCard.tsx` reusable card component
  - [ ] Use shadcn/ui Card, CardHeader, CardTitle, CardDescription, CardContent
  - [ ] Create sections for: Profile, Notifications (placeholder), AI Participation (placeholder)
  - [ ] Display user email (read-only) in Profile section with Label
  - [ ] Add descriptive text for each section
  - [ ] Apply responsive design: single column on mobile, max-width 800px on desktop
  - [ ] Use proper spacing (p-6 for cards, space-y-6 between cards)

- [ ] Task 4: Implement accessibility features (AC: 6, 7)
  - [ ] Add page-level H1: "Settings"
  - [ ] Add section-level H2s for each card ("Profile", "Notifications", etc.)
  - [ ] Ensure all form controls have associated labels
  - [ ] Add descriptive aria-labels where needed
  - [ ] Verify keyboard navigation flow (Tab through all interactive elements)
  - [ ] Test with screen reader (VoiceOver/NVDA)
  - [ ] Run jest-axe and fix any violations

- [ ] Task 5: Create placeholder sections for future stories (AC: 4)
  - [ ] Create "Notifications" card with placeholder text: "Email and SMS preferences coming soon"
  - [ ] Create "AI Participation" card with placeholder text: "AI-assisted intake features coming soon"
  - [ ] Use muted text color for placeholder content
  - [ ] Ensure placeholders are properly labeled for screen readers

- [ ] Task 6: Create comprehensive tests (AC: All)
  - [ ] Component tests for SettingsCard:
    - Renders with title and description
    - Renders children content
    - Applies responsive classes correctly
  - [ ] Integration tests for Settings page:
    - Redirects unauthenticated users to login
    - Displays authenticated user's email
    - Renders all placeholder sections
    - Navigation link is present and functional
  - [ ] Accessibility tests with jest-axe:
    - Zero violations on settings page
    - Proper heading hierarchy
    - All interactive elements reachable via keyboard
  - [ ] Responsive tests:
    - Layout adapts correctly at 360px, 768px, 1024px breakpoints
    - Cards stack vertically on mobile
    - Max-width constraint applied on desktop

## Dev Notes

### **Previous Story Insights**
- Authentication system working with `requireAuth` from `lib/auth/server-auth.ts`
- AppHeader component exists with navigation structure
- shadcn/ui components (Card, Label, etc.) already installed and configured
- Repository pattern established for Firestore operations
- React Query configured for client-side data fetching

### **Design Requirements** (from Epic 11 PRD)
- Use shadcn/ui Card components for visual sections
- Mobile-first responsive design
- Trust-building tone - clear, transparent copy
- Generous touch targets (minimum 44x44px)
- Inline feedback for future save actions (Story 11.2)

### **Page Structure**
```
┌─────────────────────────────────────┐
│ ⚙️ Settings                          │ ← H1
├─────────────────────────────────────┤
│                                     │
│ ┌─ Profile Card ─────────────────┐ │
│ │ Email: user@example.com         │ │
│ │ (Account info managed by Auth)  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─ Notifications Card ────────────┐│
│ │ Email and SMS preferences       │ │
│ │ coming soon...                  │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─ AI Participation Card ─────────┐│
│ │ AI-assisted intake features     │ │
│ │ coming soon...                  │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

### **Component Architecture**
```
app/settings/page.tsx (Server Component)
├─ Fetch user auth (requireAuth)
├─ Return SettingsPage (Client Component)
   ├─ SettingsCard (Profile)
   │  └─ Display email (read-only)
   ├─ SettingsCard (Notifications - placeholder)
   └─ SettingsCard (AI Participation - placeholder)
```

### **File Locations** [Source: architecture/source-tree.md]
- Main page: `app/settings/page.tsx` (new file)
- Client component: `components/settings/SettingsPage.tsx` (new file)
- Card component: `components/settings/SettingsCard.tsx` (new file, reusable)
- Nav update: `components/layouts/AppHeader.tsx` (modify existing)
- Tests: 
  - `tests/settings/SettingsPage.test.tsx` (new file)
  - `tests/settings/SettingsCard.test.tsx` (new file)
  - `tests/layouts/AppHeader.test.tsx` (update existing)

### **Authentication Pattern**
```typescript
// app/settings/page.tsx (Server Component)
import { requireAuth } from '@/lib/auth/server-auth';
import { SettingsPage } from '@/components/settings/SettingsPage';

export default async function Settings() {
  const user = await requireAuth(); // Throws if not authenticated
  
  return <SettingsPage user={user} />;
}
```

### **shadcn/ui Card Usage**
```typescript
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";

<Card>
  <CardHeader>
    <CardTitle>Profile</CardTitle>
    <CardDescription>
      Your account information
    </CardDescription>
  </CardHeader>
  <CardContent>
    {/* Content here */}
  </CardContent>
</Card>
```

### **Responsive Breakpoints**
- **Mobile** (< 768px):
  - Single column layout
  - Full-width cards with padding
  - Stack vertically with space-y-6
  
- **Desktop** (≥ 768px):
  - Centered container, max-width 800px
  - Cards maintain max-width
  - Same vertical stacking (no side-by-side)

### **Accessibility Requirements** [Source: docs/accessibility-audit.md]
- WCAG 2.1 AA compliance mandatory
- Page structure:
  - H1 for page title ("Settings")
  - H2 for each card section ("Profile", "Notifications", etc.)
  - Proper heading hierarchy (no skipped levels)
- Keyboard navigation:
  - All interactive elements reachable via Tab
  - Visible focus indicators
  - Logical tab order
- Screen reader support:
  - Descriptive labels for all form controls
  - aria-label for icon-only buttons (if any)
  - Card descriptions provide context

### **Navigation Integration**
```typescript
// components/layouts/AppHeader.tsx
import { Settings } from 'lucide-react';

// Add to nav items array:
{
  name: 'Settings',
  href: '/settings',
  icon: Settings,
}
```

### **Testing Strategy**
```typescript
// tests/settings/SettingsPage.test.tsx
describe('SettingsPage', () => {
  it('renders page title and all sections', () => {
    render(<SettingsPage user={mockUser} />);
    expect(screen.getByRole('heading', { name: 'Settings', level: 1 })).toBeInTheDocument();
    expect(screen.getByText('Profile')).toBeInTheDocument();
    expect(screen.getByText('Notifications')).toBeInTheDocument();
    expect(screen.getByText('AI Participation')).toBeInTheDocument();
  });

  it('displays user email in profile section', () => {
    render(<SettingsPage user={mockUser} />);
    expect(screen.getByText(mockUser.email)).toBeInTheDocument();
  });

  it('has zero accessibility violations', async () => {
    const { container } = render(<SettingsPage user={mockUser} />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

### **Technical Constraints**
- TypeScript strict mode - no `any` types
- Server component for auth check, client component for interactivity (future stories)
- Follow repository pattern (no direct Firestore calls from UI yet - Story 11.2)
- Use shadcn/ui components for consistency
- Mobile-first responsive design
- Zero accessibility violations required

### **Integration Points**
- AppHeader navigation: Add settings link with active state
- Authentication: Use `requireAuth` for route protection
- Firebase Auth: Read user email for display
- Design system: Use existing shadcn/ui Card, Label components

### **Out of Scope for Story 11.1**
- Editing any user settings (Story 11.2)
- Saving changes to Firestore (Story 11.2)
- AI participation toggle functionality (Story 11.3)
- Notification preference toggles (Story 11.2)
- Time zone selector (Story 11.2)
- Form validation (Story 11.2)

### **User Firestore Schema** (Reference for Story 11.2)
```typescript
// Collection: users
interface UserSettings {
  uid: string;
  email: string;
  timeZone?: string;
  notifications?: {
    email: boolean;
    sms: boolean;
  };
  aiParticipation?: boolean;
  updatedAt: Timestamp;
}
```

### **Placeholder Content Guidelines**
All placeholder sections should:
- Use clear, descriptive text explaining what's coming
- Use muted text color (`text-muted-foreground`)
- Be properly labeled for screen readers
- Maintain visual hierarchy with other sections
- Example: "Email and SMS reminder preferences will be available in the next release."

## Testing

- Use Vitest + React Testing Library per `CLAUDE.md`.
- Test server-side auth protection (redirects unauthenticated users).
- Test client-side rendering of user info and placeholder sections.
- Accessibility: jest-axe for zero violations, manual keyboard walkthrough.
- Responsive: Test at 360px, 768px, 1024px viewports.
- Navigation: Verify settings link appears in nav and navigates correctly.

## Change Log

| Date | Version | Description | Author |
| --- | --- | --- | --- |
| 2025-10-11 | 0.1 | Initial draft created from Epic 11 PRD | SM Agent (Bob) |

